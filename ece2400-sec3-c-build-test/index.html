



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Christopher Batten">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.13">
    
    
      
        <title>Section 3: C Build and Test Frameworks - ECE 2400 Section Handouts</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.077507d7.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.ff0a5ce4.min.css">
      
      
        
        
        <meta name="theme-color" content="#2094f3">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#section-3-c-build-and-test-frameworks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="ECE 2400 Section Handouts" class="md-header-nav__button md-logo" aria-label="ECE 2400 Section Handouts">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ECE 2400 Section Handouts
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Section 3: C Build and Test Frameworks
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/cornell-ece2400/ece2400-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cornell-ece2400/ece2400-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ECE 2400 Section Handouts" class="md-nav__button md-logo" aria-label="ECE 2400 Section Handouts">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ECE 2400 Section Handouts
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cornell-ece2400/ece2400-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cornell-ece2400/ece2400-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../ece2400-sec1-linux/" title="Section 1: Linux Development Environment" class="md-nav__link">
      Section 1: Linux Development Environment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ece2400-sec2-c-basics/" title="Section 2: Compiling and Running C Programs" class="md-nav__link">
      Section 2: Compiling and Running C Programs
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Section 3: C Build and Test Frameworks
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Section 3: C Build and Test Frameworks" class="md-nav__link md-nav__link--active">
      Section 3: C Build and Test Frameworks
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-logging-into-ecelinux" class="md-nav__link">
    1. Logging Into ecelinux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-makefiles-to-compile-c-programs" class="md-nav__link">
    2. Using Makefiles to Compile C Programs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-using-cmake-to-generate-makefiles-for-compiling-c-programs" class="md-nav__link">
    3. Using CMake to Generate Makefiles for Compiling C Programs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-using-ctest-for-systematic-unit-testing" class="md-nav__link">
    4. Using CTest for Systematic Unit Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-using-a-build-directory" class="md-nav__link">
    5. Using a Build Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-experimenting-with-build-and-test-frameworks-for-pa1" class="md-nav__link">
    6. Experimenting with Build and Test Frameworks for PA1
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-logging-into-ecelinux" class="md-nav__link">
    1. Logging Into ecelinux
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-using-makefiles-to-compile-c-programs" class="md-nav__link">
    2. Using Makefiles to Compile C Programs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-using-cmake-to-generate-makefiles-for-compiling-c-programs" class="md-nav__link">
    3. Using CMake to Generate Makefiles for Compiling C Programs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-using-ctest-for-systematic-unit-testing" class="md-nav__link">
    4. Using CTest for Systematic Unit Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-using-a-build-directory" class="md-nav__link">
    5. Using a Build Directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-experimenting-with-build-and-test-frameworks-for-pa1" class="md-nav__link">
    6. Experimenting with Build and Test Frameworks for PA1
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cornell-ece2400/ece2400-docs/edit/master/docs/ece2400-sec3-c-build-test.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="section-3-c-build-and-test-frameworks">Section 3: C Build and Test Frameworks<a class="headerlink" href="#section-3-c-build-and-test-frameworks" title="Permanent link">&para;</a></h1>
<p>In the previous discussion section, you learned how to explicitly compile
and run C programs from the command line. You learned how to use the GNU
C Compiler (<code>gcc</code>) to compile both a single-file and multi-file program
that calculated the average of two integers. You probably noticed that it
can be tedious to have to carefully enter the correct commands on the
command line. We also need to carefully track which steps need to be
redone whenever we change a C source file. In this discussion section, we
will explore using a <em>build framework</em> based on CMake to automate this
process. In the previous discussion section, you also learned how to do
ad-hoc testing by executing a function and then simply printing out the
result to the terminal. In this discussion section, we will explore using
a <em>test framework</em> to automate this process. Using a build and test
framework is critical to productive system-level programming in C and
C++.</p>
<h2 id="1-logging-into-ecelinux">1. Logging Into ecelinux<a class="headerlink" href="#1-logging-into-ecelinux" title="Permanent link">&para;</a></h2>
<p>Follow the same process as in the last section. If you are participating
in the discussion section in-person in 225 Upson Hall, then all you need
to do is find a free workstation and log into the workstation using your
NetID and standard NetID password. Remote access students might also need
to start the Cornell VPN. Then connect to <code>ecelinux</code> using X2go:</p>
<ul>
<li>start X2go (in Upson 225 just double click the X2Go client on the desktop)</li>
<li>double click on the <code>ecelinux</code> session or ...</li>
<li>setup a new X2go session by configuring the <em>Session</em> and <em>Media</em> tabs<ul>
<li>session name: <em>ecelinux</em></li>
<li>host: <em>ecelinux.ece.cornell.edu</em></li>
<li>login: <em>cb535</em></li>
<li>session type: <em>XFCE</em></li>
<li>uncheck <em>enable sound support</em></li>
<li>uncheck <em>client side printing support</em></li>
</ul>
</li>
<li>click <em>OK</em></li>
<li>enter your standard NetID password</li>
<li>if asked to trust a certificate for the servers, click <em>yes</em></li>
<li>if asked about a Windows firewall setup, click <em>cancel</em></li>
<li>open a terminal using <em>Applications &gt; Terminal Emulator</em>
    from the <em>Applications</em> menu</li>
<li>make sure you source the setup script</li>
<li>verify ECE2400 is in your prompt</li>
</ul>
<p>Now clone the GitHub repo we will be using in this section using the
following commands:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">source</span> setup-ece2400.sh
% mkdir -p <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400
% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400
% git clone git@github.com:cornell-ece2400/ece2400-sec3 sec3
% <span class="nb">cd</span> sec3
% cat README.md
</code></pre></div>
</td></tr></table>

<p>The given <code>src</code> directory includes the following files:</p>
<ul>
<li><code>ece2400-stdlib.h</code> : ECE 2400 course standard library header</li>
<li><code>ece2400-stdlib.c</code> : ECE 2400 course standard library implementation</li>
<li><code>avg-sfile.c</code>: source and main for single-file <code>avg</code> program</li>
<li><code>avg.h</code>: header file for the <code>avg</code> function</li>
<li><code>avg.c</code>: source file for the <code>avg</code> function</li>
<li><code>avg-mfile.c</code> : <code>main</code> for multi-file <code>avg</code> program</li>
<li><code>avg-mfile-directed-test.c</code> : directed test cases</li>
</ul>
<h2 id="2-using-makefiles-to-compile-c-programs">2. Using Makefiles to Compile C Programs<a class="headerlink" href="#2-using-makefiles-to-compile-c-programs" title="Permanent link">&para;</a></h2>
<p>Let's remind ourselves how to explicitly compile and run a single-file C
program on the command line:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% gcc -Wall -o avg-sfile avg-sfile.c
% ./avg-sfile
</code></pre></div>
</td></tr></table>

<p>Let's now remove the binary so we are back to a clean directory:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% rm -rf avg-sfile
</code></pre></div>
</td></tr></table>

<p>We will start by using a new tool called <code>make</code> which was specifically
designed to help automate the process of building C programs. The key to
using <code>make</code> is developing a <code>Makefile</code>. A <code>Makefile</code> is a plain text
file which contains a list of <em>rules</em> which together specify how to
execute commands to accomplish some task. Each rule has the following
syntax:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">target</span> <span class="o">:</span> <span class="n">prerequisite0</span> <span class="n">prerequisite1</span> <span class="n">prerequisite2</span>
<span class="o">&lt;</span><span class="n">TAB</span><span class="o">&gt;</span><span class="n">command</span>
</code></pre></div>
</td></tr></table>

<p>A rule specifies how to generate the target file using the list of
prerequisite files and the given Linux command. <code>make</code> is smart enough to
know it should rerun the command if any of the prerequisites change, and
it also knows that if one of the prerequisites does not exist then it
needs to look for some other rule to generate that prerequisite first. It
is very important to note that <code>make</code> requires commands in a rule to
start with a real TAB character. So you should not type the letters
<code>&lt;TAB&gt;</code>, but you should instead press the TAB key and verify that it has
inserted a real TAB character (i.e., if you move the left/right arrows
the cursor should jump back and forth across the TAB). This is the only
time in the course where you should use a real TAB character as opposed
to spaces.</p>
<p>Let's create a simple <code>Makefile</code> to compile a single-file C program. Use
your favorite text editor to create a file named <code>Makefile</code> in the <code>src</code>
directory with the following content:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nf">avg-sfile</span><span class="o">:</span> <span class="n">avg</span>-<span class="n">sfile</span>.<span class="n">c</span>
<span class="err">&lt;TAB&gt;gcc</span> <span class="err">-Wall</span> <span class="err">-o</span> <span class="err">avg-sfile</span> <span class="err">avg-sfile.c</span>

<span class="nf">clean</span><span class="o">:</span>
<span class="err">&lt;TAB&gt;rm</span> <span class="err">-rf</span> <span class="err">avg-sfile</span>
</code></pre></div>
</td></tr></table>

<p>We can use the newly created <code>Makefile</code> like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make avg-sfile
% ./avg-sfile
</code></pre></div>
</td></tr></table>

<p><code>make</code> will by default use the <code>Makefile</code> in the current directory.
<code>make</code> takes a command line argument specifying what you want "make". In
this case, we want to make the <code>avg-sfile</code> executable. <code>make</code> will look
at all of the rules in the <code>Makefile</code> to find a rule that specifies how
to make the <code>avg-sfile</code> executable. It will then check to make sure the
prerequisites exist and that they are up-to-date, and then it will run
the command specified in the rule for <code>avg-sfile</code>. In this case, that
command is <code>gcc</code>. <code>make</code> will output to the terminal every command it
runs, so you should see it output the command line which uses <code>gcc</code> to
generate the <code>avg-sfile</code> executable.</p>
<p>Try running <code>make</code> again:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make avg-sfile
% ./avg-sfile
</code></pre></div>
</td></tr></table>

<p><code>make</code> detects that the prerequisite (i.e., <code>avg-sfile.c</code>) has not
changed and so it does not recompile the executable. Now let's try making
a change in the <code>avg-sfile.c</code> source file. Modify the <code>printf</code> statement
as follows:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">printf</span><span class="p">(</span><span class="s">&quot;avg( %d, %d ) == %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">);</span>
</code></pre></div>
</td></tr></table>

<p>You can recompile and re-execute the program like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make avg-sfile
% ./avg-sfile
</code></pre></div>
</td></tr></table>

<p><code>make</code> will automatically detect that the prerequisite has changed and
recompile the executable appropriately. This ability to automatically
track dependencies and recompile just what is necessary is a key benefit
of using a tool like <code>make</code>. <code>Makefiles</code> can also include targets which
are not actually files. Our example <code>Makefile</code> includes a <code>clean</code> target
which will delete any generated executables. Let's clean up our directory
like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% ls
% make clean
% ls
</code></pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">To-Do On Your Own</p>
<p>Add two rules to your <code>Makefile</code> to compile <code>avg.o</code> and
<code>avg-mfile.o</code>. Add a rule that links these two object files together
and produces <code>avg-mfile</code>. Update the rule for the <code>clean</code> target
appropriately. Carefully consider what command and prerequisites to
use for each target. Test out your <code>Makefile</code>. Try changing <code>avg.c</code>
and rerunning <code>make</code>. Does your program recompile correctly? Try
changing <code>avg.h</code> and rerunning <code>make</code>. Does your program recompile
correctly?</p>
</div>
<h2 id="3-using-cmake-to-generate-makefiles-for-compiling-c-programs">3. Using CMake to Generate Makefiles for Compiling C Programs<a class="headerlink" href="#3-using-cmake-to-generate-makefiles-for-compiling-c-programs" title="Permanent link">&para;</a></h2>
<p>While using <code>make</code> can help automate the build process, the corresponding
<code>Makefiles</code> can quickly grow to be incredibly complicated. Creating and
maintaining these <code>Makefiles</code> can involve significant effort. It can be
particularly challenging to ensure all of the dependencies between the
various source and header files are always correctly captured in the
<code>Makefile</code>. It can also be complicated to add support for code coverage,
memory checking, and debug vs. evaluation builds.</p>
<p>New tools have been developed to help <em>automate</em> the process of managing
<code>Makefiles</code> (which in turn <em>automate</em> the build process). Automation is
the key to effective software development methodologies. In this course,
we will be using CMake as a key step in our build framework. CMake takes
as input a simple <code>CMakeLists.txt</code> file and <em>generates</em> a sophisticated
<code>Makefile</code> for us to use. A <code>CMakeLists.txt</code> is a plain text file with a
list of commands that specify what tasks we would like the generated
<code>Makefile</code> to perform.</p>
<p>Before getting started let's remove any files we have generated and also
remove the <code>Makefile</code> we developed in the previous section.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make clean
% trash Makefile
</code></pre></div>
</td></tr></table>

<p>Let's create a simple <code>CMakeLists.txt</code> that can be used to generate a
<code>Makefile</code> which will in turn be used to compile a single-file C program.
User your favorite text editor to create a file named <code>CMakeLists.txt</code> in
the <code>src</code> directory with the following content:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span> <span class="s">2.8</span><span class="p">)</span>
<span class="nb">enable_language</span><span class="p">(</span><span class="s">C</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span> <span class="s">avg-sfile</span> <span class="s">avg-sfile.c</span> <span class="p">)</span>
</code></pre></div>
</td></tr></table>

<p>Line 1 specifies the CMake version we are assuming, and line 2 specifies
that we will be using CMake with a C project. Line 3 specifies that we
want to generate a <code>Makefile</code> that can compile an executable named
<code>avg-sfile</code> form the <code>avg-sfile.c</code> source file. Now let's run the <code>cmake</code>
command to generate a <code>Makefile</code> we can use to compile <code>avg-sfile</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% cmake .
% ls
% less Makefile
</code></pre></div>
</td></tr></table>

<p>The <code>cmake</code> command will by default use the <code>CMakeLists.txt</code> in the
directory given as a command line argument. CMake takes care of figuring
out what C compilers are available and then generating the <code>Makefile</code>
appropriately. You can see that CMake has automatically generated a
pretty sophisticated <code>Makefile</code>. Let's go ahead and use this <code>Makefile</code>
to build <code>avg-sfile</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make avg-sfile
% ./avg-sfile
</code></pre></div>
</td></tr></table>

<p>CMake will automatically create some useful targets like <code>clean</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make clean
</code></pre></div>
</td></tr></table>

<p>Writing a <code>CMakeLists.txt</code> is simpler than writing a <code>Makefile</code>,
especially when we start working with many files.</p>
<div class="admonition note">
<p class="admonition-title">To-Do On Your Own</p>
<p>Add another line to your <code>CMakeLists.txt</code> file to specify that we
want to generate a <code>Makefile</code> that can be used to compile <code>avg-mfile</code>
from <code>avg-mfile.c</code> and <code>avg.c</code>. Use CMake to generate the
corresponding <code>Makefile</code> and then use <code>make</code> to compile <code>avg-mfile</code>.
Try changing <code>avg.c</code> and rerunning <code>make</code>. Does your program
recompile correctly? Try changing <code>avg.h</code> and rerunning <code>make</code>. Does
your program recompile correctly?</p>
</div>
<h2 id="4-using-ctest-for-systematic-unit-testing">4. Using CTest for Systematic Unit Testing<a class="headerlink" href="#4-using-ctest-for-systematic-unit-testing" title="Permanent link">&para;</a></h2>
<p>So far we have been using "ad-hoc testing". For example, the <code>main</code>
function in <code>avg-sfile.c</code> will execute the <code>avg</code> function with one set of
inputs and then print the result to the terminal. If it is not what we
expected, we can debug our program until it meets our expectations.
Unfortunately, ad-hoc testing is error prone and not easily reproducible.
If you later make a change to your implementation, you would have to take
another look at the output to ensure your implementation still works. If
another developer wants to understand your implementation and verify that
it is working, he or she would also need to take a look at the output and
think hard about what is the expected result. Ad-hoc testing is usually
verbose, which makes it error prone, and does not use any kind of
standard test output. While ad-hoc testing might be feasible for very
simple implementations, it is obviously not a scalable approach when
developing the more complicated implementations we will tackle in this
course.</p>
<p>New tools have been developed to help automate the process of testing
implementations. These tools provide a <em>systematic</em> way to do automated
unit testing including standardized naming conventions, test output, and
test drivers. In this course, we will be using CTest as a key step in our
test framework. CTest elegantly integrates with CMake to create a unified
built and test framework. Each unit test will be a stand-alone test
program. The following is an example of a unit test program for our <code>avg</code>
function:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&quot;avg.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;ece2400-stdlib.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">test_case_1_basic</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span>  <span class="p">);</span>
  <span class="n">ECE2400_CHECK_INT_EQ</span><span class="p">(</span> <span class="n">avg</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span> <span class="p">),</span> <span class="mi">15</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">__n</span> <span class="o">=</span> <span class="p">(</span> <span class="n">argc</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">atoi</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">__n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">__n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">test_case_1_basic</span><span class="p">();</span>

  <span class="n">printf</span><span class="p">(</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">__failed</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Our test programs will consist of a number of <em>test cases</em>. Each test
case is a separate function which should focus on testing a specific
subset of inputs. In this example, test case 1 tests very basic
functionality. Each test case should start with a statement similar to
line 7. <code>__func__</code> is a built-in variable which contains the function
name, so these lines basically print out the name of the function. Each
test case should then use a series of <code>ECE2400_CHECK</code> macros to check
that the implementation produces the expected results. For example, on
line 8 we check that the average of 10 and 20 is 15. If the check passes,
then the macro prints out the values, and we move on to the next test
check. If the check fails, then the macro prints out an error message,
sets the global <code>__failed</code> variable, and returns ending that test case.
The return value enables our test program to inform CTest of whether or
not all of our test cases passed of failed. The main function's job is to
simply call each test case function. Note that we get a single command
line argument which specifies which test case we want to run. If we do
not specify a command line argument then we run all of the test cases.</p>
<p>We have provided the above test program in the repository for this
discussion section. To use CTest, we need to tell it about this new test
program. We can do this by simply adding a new line to our
<code>CMakeLists.txt</code> file. Here is an example <code>CMakeLists.txt</code> file:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span> <span class="s">2.8</span><span class="p">)</span>
<span class="nb">enable_language</span><span class="p">(</span><span class="s">C</span><span class="p">)</span>
<span class="nb">enable_testing</span><span class="p">()</span>

<span class="nb">add_executable</span><span class="p">(</span> <span class="s">avg-sfile</span> <span class="s">avg-sfile.c</span> <span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span> <span class="s">avg-mfile</span> <span class="s">avg-mfile.c</span> <span class="s">avg.c</span> <span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span> <span class="s">avg-mfile-directed-test</span> <span class="s">avg-mfile-directed-test.c</span> <span class="s">avg.c</span> <span class="s">ece2400-stdlib.c</span> <span class="p">)</span>
<span class="nb">add_test</span><span class="p">(</span> <span class="s">avg-mfile-directed-test</span> <span class="s">avg-mfile-directed-test</span> <span class="p">)</span>
</code></pre></div>
</td></tr></table>

<p>Line 3 tells CMake to turn on support for testing with CTest. Line 6
specifies how to build <code>avg-mfile</code>. Line 8 specifies how to build the
<code>avg-mfile-directed-test</code> test program. Note we need to link in the
implementation of the course library because <code>avg-mfile-directed-test.c</code>
uses it. Line 9 tells CMake that <code>avg-mfile-directed-test</code> is a test that
should be managed by CTest. Modify your <code>CMakeLists.txt</code> file to look
like what is given above, rerun cmake, build the test, and run it.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% cmake .
% make avg-mfile-directed-test
% ./avg-mfile-directed-test
% ./avg-mfile-directed-test <span class="m">1</span>
</code></pre></div>
</td></tr></table>

<p>The command <code>./avg-mfile-directed-test</code> runs all test cases defined in
<code>avg-mfile-directed-test</code> and does not print anything when the test case
passes. If you want to see more information about the passing assertions,
you can zoom in to a specific test case (e.g., test case 1) using
<code>./avg-mfile-directed-test 1</code>. We will also be doing extensive <em>directed
testing</em> and <em>random testing</em>. In directed testing, you explicitly use
test assertions to test as many corner cases as possible. In random
testing, you use random input values and compare the output to some
golden "reference" implementation to hopefully catch bugs missed in your
directed testing.</p>
<p>CMake provides a <code>test</code> target which can run all of the tests and
provides a summary.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make <span class="nb">test</span>
</code></pre></div>
</td></tr></table>

<p>It is always a good idea to occasionally force a test to fail to ensure
your test framework is behaving correctly. Use your favoriate text
editor and change file <code>avg.c</code> to look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&quot;avg.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">avg</span><span class="p">(</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">sum</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Note how <code>sum</code> is calculated as the sum of <code>x</code> and <code>x</code> instead of <code>x</code> and
<code>y</code>. Then rebuild and rerun the test like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make avg-mfile-directed-test
% make <span class="nb">test</span>
% ./avg-mfile-directed-test
</code></pre></div>
</td></tr></table>

<p>You should see the test failing in the test summary, and then see
additional information about the failing test assertion when you
explicitly run the test program.</p>
<p>The ECE 2400 course standard library provides <code>ECE2400_DEBUG</code>, a macro
that allows you to print out extra information for debugging purposes.
One advantage of using the debug macro over <code>printf</code> is that this macro
incurs zero run time overhead in the evaluation build. Indeed, this macro
is simply replaced with a semi-colon when the build type is specified as
<code>eval</code>. That means the same implementation of your <code>sqrt</code> or <code>pow</code>
function can be reused for evaluation purposes without removing all
debugging <code>printf</code>s first. To use the debug macro, change file <code>avg.c</code> to
look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&quot;avg.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;ece2400-stdlib.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">avg</span><span class="p">(</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">ECE2400_DEBUG</span><span class="p">(</span><span class="s">&quot;avg( %d, %d )&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="p">;</span>
  <span class="n">ECE2400_DEBUG</span><span class="p">(</span><span class="s">&quot;sum is %d&quot;</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">sum</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Next, change <code>CMakeLists.txt</code> to look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span> <span class="s">2.8</span><span class="p">)</span>
<span class="nb">enable_language</span><span class="p">(</span><span class="s">C</span><span class="p">)</span>
<span class="nb">enable_testing</span><span class="p">()</span>

<span class="nb">add_executable</span><span class="p">(</span> <span class="s">avg-sfile</span> <span class="s">avg-sfile.c</span> <span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span> <span class="s">avg-mfile</span> <span class="s">avg-mfile.c</span> <span class="s">avg.c</span> <span class="s">ece2400-stdlib.c</span> <span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span> <span class="s">avg-mfile-directed-test</span> <span class="s">avg-mfile-directed-test.c</span> <span class="s">avg.c</span> <span class="s">ece2400-stdlib.c</span> <span class="p">)</span>
<span class="nb">add_test</span><span class="p">(</span> <span class="s">avg-mfile-directed-test</span> <span class="s">avg-mfile-directed-test</span> <span class="p">)</span>
</code></pre></div>
</td></tr></table>

<p>Since we are using utilities from the course standard library, we need to
compile targets who depend on <code>avg.c</code> together with the implementation of
the course library (line 6 and 8). Then rebuild and rerun the test like
this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make avg-mfile-directed-test
% ./avg-mfile-directed-test
% ./avg-mfile-directed-test <span class="m">1</span>
</code></pre></div>
</td></tr></table>

<p>Note how the debug info is suppressed when you are not zooming into a
specific test case. You should see a line starting with <code>[ -info- ]</code> in
the output, which corresponds to the debug macro we added in <code>avg.c</code>.
This info line tells us the sum of <code>x</code> and <code>y</code> is 20 instead of 30, and
we should realize that we made a mistake while calculating the sum.</p>
<div class="admonition note">
<p class="admonition-title">To-Do On Your Own</p>
<p>In this to-do activity you will work on <code>avg-mfile-directed-test</code> to
add one more test case. Add a second test case named
<code>test_case_2_truncate</code> which explicitly tests situations where the
average has to be truncated (e.g., the average of 10 and 15 is 12.5
which will be truncated to 12). Update the <code>main</code> function to call
this new test case. Use CMake and CTest to rerun the tests.</p>
</div>
<h2 id="5-using-a-build-directory">5. Using a Build Directory<a class="headerlink" href="#5-using-a-build-directory" title="Permanent link">&para;</a></h2>
<p>Take a look at the source directory. It likely contains a mess of
generated directories, object files, executables, etc. It is usually very
bad practice to build C programs directly in the <em>source</em> directory. It
is much better to build C programs in a completely separate <em>build</em>
directory. Adding support for these build directories in a <code>Makefile</code> is
complex, but CMake makes it easy. Let's start by deleting all generated
content in your source directory:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3/src
% make clean
% trash CMakeCache.txt CMakeFiles *.cmake Testing
</code></pre></div>
</td></tr></table>

<p>Now let's first create a separate build directory, use CMake to create
a new <code>Makefile</code>, and finally build and run all of our tests.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3
% mkdir build
% <span class="nb">cd</span> build
% cmake ../src
% make
% make <span class="nb">test</span>
</code></pre></div>
</td></tr></table>

<p>A separate build directory makes it easy to do a "clean build" where you
start your build from scratch. Simply remove the build directory and
start again like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/sec3
% trash build
% mkdir build
% <span class="nb">cd</span> build
% cmake ../src
% make
% make <span class="nb">test</span>
</code></pre></div>
</td></tr></table>

<p>You should <strong>never</strong> check in your <code>build</code> directory or any generated
content into Git. Only source files are checked into Git!</p>
<h2 id="6-experimenting-with-build-and-test-frameworks-for-pa1">6. Experimenting with Build and Test Frameworks for PA1<a class="headerlink" href="#6-experimenting-with-build-and-test-frameworks-for-pa1" title="Permanent link">&para;</a></h2>
<p>Let's experiment with the build and test frameworks for the first
programming assignment using what we have learned in this discussion
section. You can use the following steps to clone your PA1 repo.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% mkdir -p <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400
% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400
% git clone git@github.com:cornell-ece2400/netid
% <span class="nb">cd</span> netid
% tree
</code></pre></div>
</td></tr></table>

<p>For each programming assignment, we will provide you a skeleton for your
project including a complete <code>CMakeLists.txt</code>. In the common case, you
should not need to modify the <code>CMakeLists.txt</code> unless you want to
incorporate additional source and/or test files. The programming
assignments are setup to use a separate build directory. The programming
assignments also group all of the tests into their own separate
directory. You can use the following steps to use the build framework
with the first programming assignment.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/netid/pa1-math
% mkdir build
% <span class="nb">cd</span> build
% cmake ..
% make check
% make check-milestone
</code></pre></div>
</td></tr></table>

<p><code>check</code> will run all of the tests for the entire PA, while
<code>check-milestone</code> will only run the tests for the milestone. If there is
a test failure, we can "zoom in" to build a single test program and run
it in isolation like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/netid/pa1-math/build
% make sqrt-iter-directed-test
% ./sqrt-iter-directed-test
</code></pre></div>
</td></tr></table>

<p>You can build and run the test program on a single line like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/netid/pa1-math/build
% make sqrt-iter-directed-test <span class="o">&amp;&amp;</span> ./sqrt-iter-directed-test
</code></pre></div>
</td></tr></table>

<p>The <code>&amp;&amp;</code> bash operator enables running multiple commands on the same
command line. Without a command line argument, the test program will run
all of the test cases. You can also use the command line argument <code>-1</code> to
print out a dot for every passing test check. Then we can "zoom in"
further, and run a single test case within a single test program so we
see exactly which test check is failing. The following will build the
directed test program, explicitly run just test case 1, and then
explicitly run just test case 2.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>% <span class="nb">cd</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/ece2400/netid/pa1-math/build
% make sqrt-iter-directed-test
% ./sqrt-iter-directed-test <span class="m">1</span>
% ./sqrt-iter-directed-test <span class="m">2</span>
</code></pre></div>
</td></tr></table>

<p>Once we fix the bug, then we can "zoom out" and move on to the next
failing test case, or to the next failing test program.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../ece2400-sec2-c-basics/" title="Section 2: Compiling and Running C Programs" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Section 2: Compiling and Running C Programs
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Christopher Batten
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../js/extras.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>